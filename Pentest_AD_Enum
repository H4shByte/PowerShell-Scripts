$results = foreach ($hostname in $hostnames) {

    Try {
        $ad_data = Get-ADComputer -Filter { DNSHostName -eq $hostname } -Properties DistinguishedName, DNSHostName, DoesNotRequirePreAuth, IPv4Address, KerberosEncryptionType, MemberOf, objectSid, OperatingSystem, OperatingSystemVersion, primaryGroupID, SamAccountName, SamAccountType, servicePrincipalName, ServicePrincipalNames, userAccountControl

        [PSCustomObject]@{
            hostname                 = $hostname
            DistinguishedName        = $ad_data.DistinguishedName
            DNSHostName              = $ad_data.DNSHostName
            DoesNotRequirePreAuth    = $ad_data.DoesNotRequirePreAuth
            IPv4_Addr                = $ad_data.IPv4Address
            KerberosEncryptionType   = $ad_data | Select-Object -ExpandProperty KerberosEncryptionType
            Memberof                 = $ad_data | Select-Object -ExpandProperty Memberof
            Name                     = $ad_data.Name
            Obj_class                = $ad_data.ObjectClass
            Obj_GUID                 = $ad_data.ObjectGUID
            Obj_SID                  = $ad_data.objectSid
            OS                       = $ad_data.OperatingSystem
            OS_version               = $ad_data.OperatingSystemVersion
            PrimaryGroupID           = $ad_data.primaryGroupID
            SAM_Acc_Name             = $ad_data.SamAccountName
            SAM_Acc_type             = $ad_data.SamAccountType
            ServicePrincipalName     = $ad_data | Select-Object -ExpandProperty ServicePrincipalName
            ServicePrincipalNames    = $ad_data | Select-Object -ExpandProperty ServicePrincipalNames
            SID                      = $ad_data.SID
            UAC                      = $ad_data.userAccountControl
        }
    }
    Catch {
        [PSCustomObject]@{
            hostname                 = $hostname
            DistinguishedName        = $null
            DNSHostName              = $null
            DoesNotRequirePreAuth    = $null
            IPv4_Addr                = $null
            KerberosEncryptionType   = $null
            Memberof                 = $null
            Name                     = $null
            Obj_class                = $null
            Obj_GUID                 = $null
            Obj_SID                  = $null
            OS                       = $null
            OS_version               = $null
            PrimaryGroupID           = $null
            SAM_Acc_Name             = $null
            SAM_Acc_type             = $null
            ServicePrincipalName     = $null
            ServicePrincipalNames    = $null
            SID                      = $null
            UAC                      = $null
        }
    }
}


$results | Export-Csv -Path C:\users\$env:USERNAME\Desktop\AD_Enumeration.csv
